#!/usr/bin/env python

import sys
import yaml
import optparse

def main():
    parser = optparse.OptionParser()
    parser.add_option('--issue', dest='issue', default=None,
        help="only print packages with issue ISSUE")
    parser.add_option('--has-bugs', dest='bugs', action='store_true',
        help="only print packages with bug(s) listed")
    parser.add_option('--no-bugs', dest='bugs', action='store_false',
        help="only print packages without bug(s) listed")
    parser.add_option('--has-comments', dest='comments', action='store_true',
        help="only print packages with comments")
    parser.add_option('--no-comments', dest='comments', action='store_false',
        help="only print packages without comments")

    options, args = parser.parse_args()

    if args:
        parser.error("command does not take any arguments")

    packages = yaml.safe_load(open('./packages.yml'))

    for x, y in sorted(packages.iteritems()):
        if options.issue is not None and \
                options.issue not in y.get('issues', ()):
            continue

        if options.bugs is not None and options.bugs ^ ('bugs' in y):
            continue

        if options.comments is not None and options.comments ^ ('comments' in y):
            continue

        print x

    return 0

if __name__ == '__main__':
    sys.exit(main())
